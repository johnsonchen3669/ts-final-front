import{d as E,r as n,v as F,B as W,c as y,a,b as o,e,y as c,f as N,_ as M,C as m,F as _,g as H,t as v,H as O,D as b,E as p,n as k,j as G,i as J,k as L,I as K}from"./main-qbu05jWT.js";import{b as Q,c as X}from"./order-NciXAoff.js";const Y={class:"container"},Z={class:"row justify-content-center"},I={class:"col-md-10"},ee={class:"row justify-content-center"},te={class:"col-md-10"},se={key:0,class:"fw-bold mb-4 pt-3"},le={key:1,class:"fw-bold mb-4 pt-3"},ae={class:"row flex-row-reverse justify-content-center pb-5"},oe={class:"col-md-4"},ne={class:"border p-4 mb-4"},de={class:"d-flex flex-column justify-content-center gap-2"},ie=["src","alt"],re={class:"w-100"},ue={class:"d-flex justify-content-between"},ce={class:"mb-0 fw-bold"},me={class:"mb-0"},ve={class:"mb-0 fw-bold"},be={class:"table mt-4 border-top border-bottom text-muted"},pe={class:"text-end border-0 px-0 pt-4"},fe={class:"d-flex justify-content-between mt-4"},ye={class:"mb-0 h4 fw-bold"},_e={class:"col-md-6"},ke={class:"mb-2"},xe={key:0,class:"invalid-feedback d-block"},he={class:"mb-2"},we={key:0,class:"invalid-feedback d-block"},ge={class:"mb-2"},Ve={key:0,class:"invalid-feedback d-block"},Te={class:"mb-2"},Ce={key:0,class:"invalid-feedback d-block"},Pe={class:"mb-2"},Se={key:1,class:"card rounded-0"},$e={class:"d-flex flex-column-reverse flex-md-row mt-4 justify-content-between align-items-md-center align-items-end w-100"},Be=["disabled"],je=["disabled"],qe=E({__name:"CheckoutView",setup(Ne){const U=K(),i=n(1),q=F(),{cart:u}=W(q),f=n(null),l=n({email:"",name:"",tel:"",address:"",message:""}),j=n(null),d=n(!1),x=n(!1),h=n(!1),w=n(!1),g=n(!1),z=()=>{d.value=!0,j.value?.click()},V=n(!1),D=async()=>{try{V.value=!0;const{message:r,...t}=l.value,B=await X({user:t,message:r});f.value=B.data.orderId,i.value=2}catch{alert("訂單建立失敗")}finally{V.value=!1}},T=y(()=>{const r=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;return l.value.email&&r.test(l.value.email.trim())}),C=y(()=>l.value.name&&l.value.name.trim()!==""),P=y(()=>{const r=/^09\d{8}$/;return l.value.tel&&r.test(l.value.tel)}),S=y(()=>l.value.address&&l.value.address.trim()!==""),R=()=>{if(f.value){i.value=2;return}z()},$=n(!1),A=async()=>{if(f.value)try{$.value=!0,await Q(f.value),U.push("/checkout-success")}catch{alert("付款失敗")}finally{$.value=!1}};return(r,t)=>{const B=J("RouterLink");return o(),a("div",Y,[e("div",Z,[e("div",I,[N(M)])]),m(u)?.carts&&m(u)?.carts.length>0?(o(),a(_,{key:0},[e("div",ee,[e("div",te,[i.value===1?(o(),a("h3",se,"輸入結帳資訊")):(o(),a("h3",le,"選擇付款方式"))])]),e("div",ae,[e("div",oe,[e("div",ne,[e("div",de,[(o(!0),a(_,null,H(m(u)?.carts,s=>(o(),a("div",{key:s.id,class:"d-flex"},[e("img",{src:s.product.imageUrl,alt:s.product.title,class:"me-2",style:{width:"48px",height:"48px","object-fit":"cover"}},null,8,ie),e("div",re,[e("div",ue,[e("p",ce,v(s.product.title),1),e("p",me,"NT$"+v(s.final_total.toLocaleString("zh-TW")),1)]),e("p",ve,"x"+v(s.qty),1)])]))),128))]),e("table",be,[e("tbody",null,[e("tr",null,[t[10]||(t[10]=e("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"},"小計",-1)),e("td",pe," NT$"+v(m(u)?.total.toLocaleString("zh-TW")),1)]),t[11]||(t[11]=e("tr",null,[e("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 font-weight-normal"},"付款方式"),e("td",{class:"text-end border-0 px-0 pt-0 pb-4"},"ApplePay")],-1))])]),e("div",fe,[t[12]||(t[12]=e("p",{class:"mb-0 h4 fw-bold"},"總計",-1)),e("p",ye,"NT$"+v(m(u)?.final_total.toLocaleString("zh-TW")),1)])])]),e("div",_e,[i.value===1?(o(),a("form",{key:0,onSubmit:O(D,["prevent"])},[e("div",ke,[t[13]||(t[13]=e("label",{for:"email",class:"text-muted mb-0"},"電子信箱",-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.email=s),onBlur:t[1]||(t[1]=s=>x.value=!0),required:"",type:"email",class:k(["form-control",{"is-invalid":!T.value&&(d.value||x.value)}]),id:"email",placeholder:"example@gmail.com"},null,34),[[p,l.value.email]]),!T.value&&(d.value||x.value)?(o(),a("div",xe," 請輸入正確的電子信箱 ")):c("",!0)]),e("div",he,[t[14]||(t[14]=e("label",{for:"name",class:"text-muted mb-0"},"姓名",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.name=s),onBlur:t[3]||(t[3]=s=>h.value=!0),required:"",type:"text",class:k(["form-control",{"is-invalid":!C.value&&(d.value||h.value)}]),id:"name",placeholder:"王漂亮"},null,34),[[p,l.value.name]]),!C.value&&(d.value||h.value)?(o(),a("div",we," 請輸入姓名 ")):c("",!0)]),e("div",ge,[t[15]||(t[15]=e("label",{for:"tel",class:"text-muted mb-0"},"手機",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.tel=s),onBlur:t[5]||(t[5]=s=>w.value=!0),required:"",type:"text",class:k(["form-control",{"is-invalid":!P.value&&(d.value||w.value)}]),id:"tel",placeholder:"0912345678"},null,34),[[p,l.value.tel]]),!P.value&&(d.value||w.value)?(o(),a("div",Ve," 請輸入正確的手機號碼 ")):c("",!0)]),e("div",Te,[t[16]||(t[16]=e("label",{for:"address",class:"text-muted mb-0"},"地址",-1)),b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.address=s),onBlur:t[7]||(t[7]=s=>g.value=!0),required:"",type:"text",class:k(["form-control",{"is-invalid":!S.value&&(d.value||g.value)}]),id:"address",placeholder:"高雄市新興區"},null,34),[[p,l.value.address]]),!S.value&&(d.value||g.value)?(o(),a("div",Ce," 請輸入正確的地址 ")):c("",!0)]),e("div",Pe,[t[17]||(t[17]=e("label",{for:"message",class:"text-muted mb-0"},"留言",-1)),b(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=s=>l.value.message=s),class:"form-control",rows:"3",id:"message",placeholder:"六角學院，只要你不放棄，我們就不放棄你 ... "},null,512),[[p,l.value.message]])]),e("button",{ref_key:"submitBtn",ref:j,type:"submit",class:"d-none"},null,512)],32)):(o(),a("div",Se,[...t[18]||(t[18]=[e("div",{class:"card-header bg-white border-0 py-3"},[e("p",{class:"mb-0 position-relative custom-checkout-label"},"Apple Pay")],-1)])])),e("div",$e,[i.value===1?(o(),a(_,{key:0},[N(B,{to:"/cart",class:"text-dark mt-md-0 mt-3"},{default:G(()=>[...t[19]||(t[19]=[e("i",{class:"fas fa-chevron-left me-2"},null,-1),L("返回",-1)])]),_:1}),e("button",{onClick:R,disabled:V.value||!T.value||!C.value||!P.value||!S.value,type:"button",class:"btn btn-dark py-3 px-7"}," 下一步 ",8,Be)],64)):(o(),a(_,{key:1},[e("button",{onClick:t[9]||(t[9]=s=>i.value=1),type:"button",class:"link-dark bg-transparent border-0 mt-md-0 mt-3 p-0"},[...t[20]||(t[20]=[e("i",{class:"fas fa-chevron-left me-2"},null,-1),L("返回 ",-1)])]),e("button",{onClick:A,disabled:$.value,type:"button",class:"btn btn-dark py-3 px-7"}," 結帳 ",8,je)],64))])])])],64)):c("",!0)])}}});export{qe as default};
