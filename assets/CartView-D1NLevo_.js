import{d as N,v as L,B as A,o as B,r as b,w as V,a as n,b as a,e as t,f as r,_ as $,C as d,j as y,i as j,F as v,g as x,D as z,E as D,t as i,h as P,k as m,A as U}from"./main-qbu05jWT.js";import{S as W,a as q,A as E}from"./sweetalert2.esm.all-DSd_L38J.js";import{a as F}from"./order-NciXAoff.js";import{a as R}from"./products-Bl5fZNFl.js";const M={class:"container"},G={key:0,class:"min-vh-100 d-flex flex-column justify-content-center align-items-center"},O={class:"my-6"},H={key:1,class:"mt-3"},J={class:"row"},K={class:"col-md-8"},Q={class:"table"},X={scope:"row",class:"border-0 px-0 font-weight-normal py-4"},Y=["src","alt"],Z={class:"mb-0 fw-bold ms-3 d-inline-block"},I={class:"border-0 align-middle",style:{"max-width":"160px"}},tt={class:"input-group pe-5"},st={class:"input-group-prepend"},ot=["onClick","disabled"],et=["value"],lt={class:"input-group-append"},nt=["onClick","disabled"],at={class:"border-0 align-middle"},dt={class:"mb-0 ms-auto"},it={class:"border-0 align-middle"},rt=["onClick","disabled"],ct={class:"input-group w-50 mb-3"},pt={class:"input-group-append"},ut=["disabled"],bt={class:"col-md-4"},mt={class:"border p-4 mb-4"},_t={class:"table text-muted border-bottom"},ft={class:"text-end border-0 px-0 pt-4"},ht={class:"d-flex justify-content-between mt-4"},yt={class:"mb-0 h4 fw-bold"},vt={class:"my-5"},wt={class:"swiper-wrapper"},gt={class:"card border-0 mb-4 position-relative position-relative"},xt=["src","alt"],kt={class:"card-body p-0"},Ct={class:"mb-0 mt-3"},Tt={class:"card-text mb-0"},St={class:"text-muted"},$t=N({__name:"CartView",setup(Nt){const c=L(),{cart:p,isUpdating:w,isDeleting:k}=A(c);B(()=>{C()});const _=b([]),f=b(null);V(()=>_.value,async e=>{e.length>0&&(await U(),f.value&&new q(f.value,{modules:[E],loop:!0,autoplay:{delay:2500,disableOnInteraction:!1},slidesPerView:2,spaceBetween:10,breakpoints:{767:{slidesPerView:3,spaceBetween:30}}}))});const C=async()=>{try{const e=await R();_.value=e.data.products}catch{alert("取得產品列表失敗")}},g=async(e,s)=>{let l=s.qty;e==="plus"?l++:l--,c.updataCartItem({id:s.id,product_id:s.product.id,qty:l})},T=async e=>{c.deleteCartItem(e)},u=b(""),h=b(!1),S=async()=>{if(u.value.trim())try{h.value=!0,await F(u.value),await c.getCart(),W.fire({toast:!0,position:"top-end",icon:"success",title:"優惠券套用成功",showConfirmButton:!1,timer:1500})}catch{alert("套用優惠券失敗，優惠券已過期或不存在")}finally{h.value=!1}};return(e,s)=>{const l=j("RouterLink");return a(),n(v,null,[t("div",M,[r($),d(p)?.carts.length===0?(a(),n("div",G,[s[2]||(s[2]=t("p",{class:"text-center"},"目前購物車還沒有任何商品",-1)),t("div",O,[r(l,{to:"/products",class:"btn btn-lg btn-dark rounded-3"},{default:y(()=>[...s[1]||(s[1]=[m("前往逛逛",-1)])]),_:1})])])):(a(),n("div",H,[s[14]||(s[14]=t("h3",{class:"mt-3 mb-4"},"購物車",-1)),t("div",J,[t("div",K,[t("table",Q,[s[6]||(s[6]=t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"border-0 ps-0"},"產品名稱"),t("th",{scope:"col",class:"border-0"},"產品數量"),t("th",{scope:"col",class:"border-0"},"價格"),t("th",{scope:"col",class:"border-0"})])],-1)),t("tbody",null,[(a(!0),n(v,null,x(d(p)?.carts,o=>(a(),n("tr",{class:"border-bottom border-top",key:o.id},[t("th",X,[t("img",{src:o.product.imageUrl,alt:o.product.title,style:{width:"72px",height:"72px","object-fit":"cover"}},null,8,Y),t("p",Z,i(o.product.title),1)]),t("td",I,[t("div",tt,[t("div",st,[t("button",{onClick:()=>g("minus",o),disabled:o.qty===1||d(w),class:"btn btn-outline-dark border-0 py-2",type:"button",id:"button-addon1"},[...s[3]||(s[3]=[t("i",{class:"fas fa-minus"},null,-1)])],8,ot)]),t("input",{type:"text",class:"form-control border-0 text-center my-auto shadow-none",readonly:"","aria-label":"Example text with button addon","aria-describedby":"button-addon1",value:o.qty},null,8,et),t("div",lt,[t("button",{onClick:()=>g("plus",o),disabled:d(w),class:"btn btn-outline-dark border-0 py-2",type:"button"},[...s[4]||(s[4]=[t("i",{class:"fas fa-plus"},null,-1)])],8,nt)])])]),t("td",at,[t("p",dt,"NT$"+i(o.final_total.toLocaleString("zh-TW")),1)]),t("td",it,[t("button",{onClick:()=>T(o.id),disabled:d(k),class:"btn btn-outline-dark border-0 py-2",type:"button"},[...s[5]||(s[5]=[t("i",{class:"fas fa-times"},null,-1)])],8,rt)])]))),128))])]),t("div",ct,[z(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>u.value=o),type:"text",class:"form-control rounded-0 border-bottom border-top-0 border-start-0 border-end-0 shadow-none",placeholder:"折扣碼"},null,512),[[D,u.value]]),t("div",pt,[t("button",{onClick:S,disabled:h.value,class:"btn btn-outline-dark border-bottom border-top-0 border-start-0 border-end-0 rounded-0",type:"button",id:"button-addon2"},[...s[7]||(s[7]=[t("i",{class:"fas fa-paper-plane"},null,-1)])],8,ut)])])]),t("div",bt,[t("div",mt,[s[12]||(s[12]=t("h4",{class:"fw-bold mb-4"},"訂單資訊",-1)),t("table",_t,[t("tbody",null,[t("tr",null,[s[8]||(s[8]=t("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"},"小計",-1)),t("td",ft," NT$"+i(d(p)?.total.toLocaleString("zh-TW")),1)]),s[9]||(s[9]=t("tr",null,[t("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 font-weight-normal"},"付款方式"),t("td",{class:"text-end border-0 px-0 pt-0 pb-4"},"ApplePay")],-1))])]),t("div",ht,[s[10]||(s[10]=t("p",{class:"mb-0 h4 fw-bold"},"總計",-1)),t("p",yt,"NT$"+i(d(p)?.final_total.toLocaleString("zh-TW")),1)]),r(l,{to:"/checkout",class:"btn btn-dark w-100 mt-4"},{default:y(()=>[...s[11]||(s[11]=[m("前往結帳",-1)])]),_:1})])])]),t("div",vt,[s[13]||(s[13]=t("h3",{class:"fw-bold"},"你可能會喜歡的植栽",-1)),t("div",{ref_key:"swiperContainer",ref:f,class:"swiper mt-4 mb-5"},[t("div",wt,[(a(!0),n(v,null,x(_.value,o=>(a(),n("div",{key:o.id,class:"swiper-slide"},[t("div",gt,[t("img",{src:o.imageUrl,class:"card-img-top object-fit-cover rounded-0",style:{height:"280px"},alt:o.title},null,8,xt),t("div",kt,[t("h4",Ct,[r(l,{to:`/products/${o.id}`},{default:y(()=>[m(i(o.title),1)]),_:2},1032,["to"])]),t("p",Tt,[m(" NT$"+i(o.price.toLocaleString("zh-TW"))+" ",1),t("span",St,[t("del",null,"NT$"+i(o.origin_price.toLocaleString("zh-TW")),1)])])])])]))),128))])],512)])]))]),r(P)],64)}}});export{$t as default};
